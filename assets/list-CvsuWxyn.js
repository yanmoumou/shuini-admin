import{d as W,h as K,r as g,a as q,C as ae,j as V,w as t,f as o,o as f,e,b as c,g as n,t as r,c as T,m as G,F as J,A as oe,E as P,_ as X,x as ne,l as I,k as se,D as de,z as Q,G as ie,H as re,I as ue,J as pe}from"./index-CEiZuroB.js";import{o as ce}from"./index-DFr7TxOb.js";const me={class:"vehicle-list"},_e=["onClick"],fe={class:"vehicle-main"},ve={class:"plate"},ge={class:"driver"},be={class:"vehicle-status"},ye=W({__name:"OrderDispatchDialog",props:{modelValue:{type:Boolean},order:{}},emits:["update:modelValue","success"],setup(k,{emit:C}){const $=k,S=C,v=K({get:()=>$.modelValue,set:h=>S("update:modelValue",h)}),i=g(!1),u=g(""),x=g(""),b=q({loadTime:"",remark:""}),U={online:"success",running:"primary",offline:"info"},A={online:"空闲",running:"运输中",offline:"离线"},y=g([{id:"1",plate:"豫A11111",driverName:"张三",capacity:35,status:"online"},{id:"2",plate:"豫A22222",driverName:"李四",capacity:32,status:"online"},{id:"3",plate:"豫A33333",driverName:"王五",capacity:35,status:"running"},{id:"4",plate:"豫A44444",driverName:"赵六",capacity:30,status:"offline"},{id:"5",plate:"豫A55555",driverName:"钱七",capacity:35,status:"online"}]),z=K(()=>u.value?y.value.filter(h=>h.plate.includes(u.value)||h.driverName.includes(u.value)):y.value);ae(v,h=>{h&&(x.value="",b.loadTime="",b.remark="")});const O=()=>{v.value=!1},M=async()=>{i.value=!0,setTimeout(()=>{P.success("派单成功"),i.value=!1,v.value=!1,S("success")},500)};return(h,d)=>{const w=o("el-descriptions-item"),B=o("el-descriptions"),m=o("el-col"),a=o("el-input"),R=o("el-tag"),N=o("el-row"),Y=o("el-date-picker"),D=o("el-form-item"),E=o("el-form"),_=o("el-button"),j=o("el-dialog");return f(),V(j,{modelValue:v.value,"onUpdate:modelValue":d[3]||(d[3]=s=>v.value=s),title:"订单派单",width:"800","close-on-click-modal":!1},{footer:t(()=>[e(_,{onClick:O},{default:t(()=>[...d[6]||(d[6]=[n("取消",-1)])]),_:1}),e(_,{type:"primary",disabled:!x.value,loading:i.value,onClick:M},{default:t(()=>[...d[7]||(d[7]=[n("确认派单",-1)])]),_:1},8,["disabled","loading"])]),default:t(()=>[e(N,{gutter:20},{default:t(()=>[e(m,{span:12},{default:t(()=>[d[4]||(d[4]=c("div",{class:"section-title"},"订单信息",-1)),e(B,{column:1,border:"",size:"small"},{default:t(()=>[e(w,{label:"订单编号"},{default:t(()=>[n(r(k.order.orderNo),1)]),_:1}),e(w,{label:"客户名称"},{default:t(()=>[n(r(k.order.customerName),1)]),_:1}),e(w,{label:"收货地址"},{default:t(()=>[n(r(k.order.address),1)]),_:1}),e(w,{label:"水泥品种"},{default:t(()=>[n(r(k.order.product),1)]),_:1}),e(w,{label:"订单吨数"},{default:t(()=>[n(r(k.order.weight)+" 吨",1)]),_:1})]),_:1})]),_:1}),e(m,{span:12},{default:t(()=>[d[5]||(d[5]=c("div",{class:"section-title"},"选择车辆",-1)),e(a,{modelValue:u.value,"onUpdate:modelValue":d[0]||(d[0]=s=>u.value=s),placeholder:"搜索车牌号/司机","prefix-icon":"Search",clearable:"",style:{"margin-bottom":"12px"}},null,8,["modelValue"]),c("div",me,[(f(!0),T(J,null,G(z.value,s=>(f(),T("div",{class:oe(["vehicle-item",{selected:x.value===s.id,disabled:s.status!=="online"}]),key:s.id,onClick:F=>s.status==="online"&&(x.value=s.id)},[c("div",fe,[c("div",ve,r(s.plate),1),c("div",ge,r(s.driverName)+" | "+r(s.capacity)+"吨",1)]),c("div",be,[e(R,{type:U[s.status],size:"small"},{default:t(()=>[n(r(A[s.status]),1)]),_:2},1032,["type"])])],10,_e))),128))])]),_:1})]),_:1}),e(E,{style:{"margin-top":"16px"},inline:!0},{default:t(()=>[e(D,{label:"预计装货时间"},{default:t(()=>[e(Y,{modelValue:b.loadTime,"onUpdate:modelValue":d[1]||(d[1]=s=>b.loadTime=s),type:"datetime",placeholder:"选择时间","value-format":"YYYY-MM-DD HH:mm"},null,8,["modelValue"])]),_:1}),e(D,{label:"备注"},{default:t(()=>[e(a,{modelValue:b.remark,"onUpdate:modelValue":d[2]||(d[2]=s=>b.remark=s),placeholder:"派单备注",style:{width:"300px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),he=X(ye,[["__scopeId","data-v-abb36b32"]]),ke={class:"order-list"},we={class:"card-header"},Ne={class:"header-left"},xe={class:"header-right"},Ve={class:"amount"},Ce=W({__name:"list",setup(k){const C=g(!1),$=g(!1),S=g(null),v=g([]),i=q({orderNo:"",customerId:"",status:"",dateRange:[]}),u=q({page:1,size:10,total:156}),x=ce,b={pending:{label:"待派单",type:"info"},dispatched:{label:"已派单",type:"warning"},loading:{label:"装货中",type:"warning"},transporting:{label:"运输中",type:"primary"},arrived:{label:"已到达",type:"primary"},signed:{label:"已签收",type:"success"},completed:{label:"已完成",type:"success"},cancelled:{label:"已取消",type:"danger"}},U=g([{id:"1",name:"某建筑公司"},{id:"2",name:"某混凝土公司"},{id:"3",name:"某工程公司"}]),A=g([{id:"1",orderNo:"YS20241223001",customerId:"1",customerName:"某建筑公司",address:"郑州市金水区xxx路",product:"P.O42.5",weight:35,amount:15750,driverName:"张三",vehiclePlate:"豫A11111",status:"transporting",createTime:"2024-12-23 08:30"},{id:"2",orderNo:"YS20241223002",customerId:"2",customerName:"某混凝土公司",address:"郑州市中原区xxx路",product:"P.C32.5",weight:32,amount:12160,driverName:"李四",vehiclePlate:"豫A22222",status:"signed",createTime:"2024-12-23 08:25"},{id:"3",orderNo:"YS20241223003",customerId:"3",customerName:"某工程公司",address:"郑州市二七区xxx路",product:"P.O52.5",weight:30,amount:15600,driverName:"",vehiclePlate:"",status:"pending",createTime:"2024-12-23 08:20"},{id:"4",orderNo:"YS20241223004",customerId:"1",customerName:"某建筑公司",address:"郑州市惠济区xxx路",product:"P.O42.5",weight:34,amount:15300,driverName:"赵六",vehiclePlate:"豫A44444",status:"loading",createTime:"2024-12-23 08:15"},{id:"5",orderNo:"YS20241223005",customerId:"2",customerName:"某混凝土公司",address:"郑州市管城区xxx路",product:"P.C32.5",weight:33,amount:12540,driverName:"",vehiclePlate:"",status:"pending",createTime:"2024-12-23 08:10"},{id:"6",orderNo:"YS20241223006",customerId:"3",customerName:"某工程公司",address:"郑州市高新区xxx路",product:"P.O42.5",weight:35,amount:15750,driverName:"钱七",vehiclePlate:"豫A55555",status:"completed",createTime:"2024-12-23 08:05"}]),y=()=>{C.value=!0,setTimeout(()=>{C.value=!1},300)},z=()=>{u.page=1,y()},O=()=>{i.orderNo="",i.customerId="",i.status="",i.dateRange=[],z()},M=m=>{v.value=m},h=m=>{S.value=m,$.value=!0},d=()=>{if(v.value.length===0){P.warning("请选择要派单的订单");return}P.info(`批量派单 ${v.value.length} 个订单`)},w=async m=>{await pe.confirm("确定取消此订单吗？","提示"),P.success("订单已取消"),y()},B=()=>{P.info("导出订单")};return ne(y),(m,a)=>{const R=o("el-input"),N=o("el-form-item"),Y=o("el-option"),D=o("el-select"),E=o("el-date-picker"),_=o("el-button"),j=o("el-form"),s=o("el-card"),F=o("el-tag"),H=o("el-icon"),p=o("el-table-column"),Z=o("el-link"),ee=o("el-table"),te=o("el-pagination"),le=de("loading");return f(),T("div",ke,[e(s,{shadow:"never"},{default:t(()=>[e(j,{model:i,inline:""},{default:t(()=>[e(N,{label:"订单号"},{default:t(()=>[e(R,{modelValue:i.orderNo,"onUpdate:modelValue":a[0]||(a[0]=l=>i.orderNo=l),placeholder:"请输入",clearable:"",style:{width:"160px"}},null,8,["modelValue"])]),_:1}),e(N,{label:"客户"},{default:t(()=>[e(D,{modelValue:i.customerId,"onUpdate:modelValue":a[1]||(a[1]=l=>i.customerId=l),placeholder:"请选择",clearable:"",filterable:"",style:{width:"160px"}},{default:t(()=>[(f(!0),T(J,null,G(U.value,l=>(f(),V(Y,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(N,{label:"状态"},{default:t(()=>[e(D,{modelValue:i.status,"onUpdate:modelValue":a[2]||(a[2]=l=>i.status=l),placeholder:"请选择",clearable:"",style:{width:"120px"}},{default:t(()=>[(f(!0),T(J,null,G(I(x),l=>(f(),V(Y,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(N,{label:"日期"},{default:t(()=>[e(E,{modelValue:i.dateRange,"onUpdate:modelValue":a[3]||(a[3]=l=>i.dateRange=l),type:"daterange","value-format":"YYYY-MM-DD",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(N,null,{default:t(()=>[e(_,{type:"primary",onClick:z},{default:t(()=>[...a[8]||(a[8]=[n("查询",-1)])]),_:1}),e(_,{onClick:O},{default:t(()=>[...a[9]||(a[9]=[n("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(s,{shadow:"never",style:{"margin-top":"16px"}},{header:t(()=>[c("div",we,[c("div",Ne,[a[10]||(a[10]=c("span",null,"订单列表",-1)),e(F,{type:"info",style:{"margin-left":"8px"}},{default:t(()=>[n("共 "+r(u.total)+" 条",1)]),_:1})]),c("div",xe,[e(_,{type:"primary",onClick:a[4]||(a[4]=l=>m.$router.push("/order/create"))},{default:t(()=>[e(H,null,{default:t(()=>[e(I(ie))]),_:1}),a[11]||(a[11]=n(" 新建订单 ",-1))]),_:1}),e(_,{onClick:d,disabled:v.value.length===0},{default:t(()=>[e(H,null,{default:t(()=>[e(I(re))]),_:1}),a[12]||(a[12]=n(" 批量派单 ",-1))]),_:1},8,["disabled"]),e(_,{onClick:B},{default:t(()=>[e(H,null,{default:t(()=>[e(I(ue))]),_:1}),a[13]||(a[13]=n(" 导出 ",-1))]),_:1})])])]),default:t(()=>[se((f(),V(ee,{data:A.value,stripe:"",onSelectionChange:M,"row-key":"id"},{default:t(()=>[e(p,{type:"selection",width:"50",selectable:l=>l.status==="pending"},null,8,["selectable"]),e(p,{prop:"orderNo",label:"订单号",width:"160"},{default:t(({row:l})=>[e(Z,{type:"primary",onClick:L=>m.$router.push(`/order/detail/${l.id}`)},{default:t(()=>[n(r(l.orderNo),1)]),_:2},1032,["onClick"])]),_:1}),e(p,{prop:"customerName",label:"客户名称","min-width":"150","show-overflow-tooltip":""}),e(p,{prop:"address",label:"收货地址","min-width":"180","show-overflow-tooltip":""}),e(p,{prop:"product",label:"水泥品种",width:"100"}),e(p,{prop:"weight",label:"吨数",width:"80",align:"right"},{default:t(({row:l})=>[n(r(l.weight),1)]),_:1}),e(p,{prop:"amount",label:"金额(元)",width:"100",align:"right"},{default:t(({row:l})=>[c("span",Ve,r(l.amount?.toLocaleString()),1)]),_:1}),e(p,{prop:"driverName",label:"司机",width:"80"},{default:t(({row:l})=>[n(r(l.driverName||"-"),1)]),_:1}),e(p,{prop:"vehiclePlate",label:"车牌号",width:"100"},{default:t(({row:l})=>[n(r(l.vehiclePlate||"-"),1)]),_:1}),e(p,{prop:"status",label:"状态",width:"90"},{default:t(({row:l})=>[e(F,{type:b[l.status]?.type,size:"small"},{default:t(()=>[n(r(b[l.status]?.label),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"createTime",label:"创建时间",width:"160"}),e(p,{label:"操作",width:"160",fixed:"right"},{default:t(({row:l})=>[e(_,{link:"",type:"primary",onClick:L=>m.$router.push(`/order/detail/${l.id}`)},{default:t(()=>[...a[14]||(a[14]=[n("查看",-1)])]),_:1},8,["onClick"]),l.status==="pending"?(f(),V(_,{key:0,link:"",type:"primary",onClick:L=>h(l)},{default:t(()=>[...a[15]||(a[15]=[n("派单",-1)])]),_:1},8,["onClick"])):Q("",!0),["pending","dispatched"].includes(l.status)?(f(),V(_,{key:1,link:"",type:"danger",onClick:L=>w(l)},{default:t(()=>[...a[16]||(a[16]=[n("取消",-1)])]),_:1},8,["onClick"])):Q("",!0)]),_:1})]),_:1},8,["data"])),[[le,C.value]]),e(te,{style:{"margin-top":"16px","justify-content":"flex-end"},"current-page":u.page,"onUpdate:currentPage":a[5]||(a[5]=l=>u.page=l),"page-size":u.size,"onUpdate:pageSize":a[6]||(a[6]=l=>u.size=l),total:u.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:y,onSizeChange:y},null,8,["current-page","page-size","total"])]),_:1}),e(he,{modelValue:$.value,"onUpdate:modelValue":a[7]||(a[7]=l=>$.value=l),order:S.value,onSuccess:y},null,8,["modelValue","order"])])}}}),De=X(Ce,[["__scopeId","data-v-1dd1f0e4"]]);export{De as default};
